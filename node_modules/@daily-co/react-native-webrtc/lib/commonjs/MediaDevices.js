"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;
var _eventTargetShim = require("event-target-shim");
var _reactNative = require("react-native");
var _EventEmitter = require("./EventEmitter");
var _getDisplayMedia = _interopRequireDefault(require("./getDisplayMedia"));
var _getUserMedia = _interopRequireDefault(require("./getUserMedia"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
const {
  WebRTCModule
} = _reactNative.NativeModules;
class MediaDevices extends _eventTargetShim.EventTarget {
  constructor() {
    super();
    this._registerEvents();
  }

  /**
   * W3C "Media Capture and Streams" compatible {@code enumerateDevices}
   * implementation.
   */
  enumerateDevices() {
    return new Promise(resolve => WebRTCModule.enumerateDevices(resolve));
  }

  /**
   * W3C "Screen Capture" compatible {@code getDisplayMedia} implementation.
   * See: https://w3c.github.io/mediacapture-screen-share/
   *
   * @returns {Promise}
   */
  getDisplayMedia() {
    return (0, _getDisplayMedia.default)();
  }

  /**
   * W3C "Media Capture and Streams" compatible {@code getUserMedia}
   * implementation.
   * See: https://www.w3.org/TR/mediacapture-streams/#dom-mediadevices-enumeratedevices
   *
   * @param {*} constraints
   * @returns {Promise}
   */
  getUserMedia(constraints) {
    return (0, _getUserMedia.default)(constraints);
  }
  _registerEvents() {
    console.log('MediaDevices _registerEvents invoked');
    WebRTCModule.startMediaDevicesEventMonitor();
    (0, _EventEmitter.addListener)(this, 'mediaDevicesOnDeviceChange', () => {
      console.log('MediaDevices => mediaDevicesOnDeviceChange');
      // @ts-ignore
      this.dispatchEvent(new _eventTargetShim.Event('devicechange'));
    });
  }
}

/**
 * Define the `onxxx` event handlers.
 */
const proto = MediaDevices.prototype;
(0, _eventTargetShim.defineEventAttribute)(proto, 'devicechange');
var _default = exports.default = new MediaDevices();
//# sourceMappingURL=MediaDevices.js.map